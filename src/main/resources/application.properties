spring.config.import=optional:file:.env[.properties]

spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:none}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL:false}
# spring.jpa.properties.hibernate.dialect - Removed: Hibernate auto-detects MySQL dialect
spring.jpa.open-in-view=false

spring.flyway.enabled=${SPRING_FLYWAY_ENABLED:false}
spring.flyway.locations=${SPRING_FLYWAY_LOCATIONS:classpath:db/migration}
spring.flyway.baseline-on-migrate=${SPRING_FLYWAY_BASELINE_ON_MIGRATE:false}
spring.flyway.validate-on-migrate=${SPRING_FLYWAY_VALIDATE_ON_MIGRATE:false}
spring.flyway.validate-migration-naming=false
spring.flyway.out-of-order=${SPRING_FLYWAY_OUT_OF_ORDER:false}
spring.flyway.clean-disabled=${SPRING_FLYWAY_CLEAN_DISABLED:true}
spring.flyway.ignore-migration-patterns=${SPRING_FLYWAY_IGNORE_MIGRATION_PATTERNS:*:ignored}
app.flyway.repair-on-migrate=${APP_FLYWAY_REPAIR_ON_MIGRATE:false}

server.port=${SERVER_PORT:8084}

spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.repositories.enabled=false

jwt.secret=${JWT_SECRET:}
jwt.access-token-expiration-ms=${JWT_ACCESS_TOKEN_EXPIRATION_MS:3600000}
jwt.refresh-token-expiration-ms=${JWT_REFRESH_TOKEN_EXPIRATION_MS:604800000}

# Encryption Configuration (AES-256-GCM for payment data)
encryption.master-key=${ENCRYPTION_MASTER_KEY:}
encryption.key-rotation-enabled=${ENCRYPTION_KEY_ROTATION_ENABLED:false}
encryption.key-rotation-days=${ENCRYPTION_KEY_ROTATION_DAYS:90}
encryption.algorithm=${ENCRYPTION_ALGORITHM:AES/GCM/NoPadding}
encryption.key-size=${ENCRYPTION_KEY_SIZE:256}
encryption.gcm-tag-length=${ENCRYPTION_GCM_TAG_LENGTH:128}
encryption.iv-length=${ENCRYPTION_IV_LENGTH:12}
encryption.encrypt-payment-amounts=${ENCRYPTION_ENCRYPT_PAYMENT_AMOUNTS:true}
encryption.encrypt-transaction-ids=${ENCRYPTION_ENCRYPT_TRANSACTION_IDS:true}
encryption.encrypt-bank-accounts=${ENCRYPTION_ENCRYPT_BANK_ACCOUNTS:true}
encryption.encrypt-settlement-amounts=${ENCRYPTION_ENCRYPT_SETTLEMENT_AMOUNTS:true}

spring.mail.host=${SPRING_MAIL_HOST:}
spring.mail.port=${SPRING_MAIL_PORT:}
spring.mail.username=${SPRING_MAIL_USERNAME:}
spring.mail.password=${SPRING_MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.starttls.enable=${SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE:true}

logging.level.com.homeexpress=${LOGGING_LEVEL_COM_HOMEEXPRESS:INFO}
logging.level.org.springframework.security=${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY:INFO}
logging.level.root=${LOGGING_LEVEL_ROOT:INFO}
logging.file.name=${LOGGING_FILE_NAME:}

# OpenAI API
openai.api.key=${OPENAI_API_KEY:}
openai.api.url=${OPENAI_API_URL:https://api.openai.com/v1/chat/completions}
openai.model=${OPENAI_MODEL:gpt-5-mini}
openai.api.timeout=${OPENAI_API_TIMEOUT:30000}
ai.detection.use-enhanced-prompt=${AI_DETECTION_USE_ENHANCED_PROMPT:true}

# AI Detection Configuration
ai.detection.confidence-threshold=${AI_DETECTION_CONFIDENCE_THRESHOLD:0.85}
ai.detection.cache-ttl-seconds=${AI_DETECTION_CACHE_TTL_SECONDS:3600}

# OpenAI budget tracking
ai.budget.openai.max-requests-per-hour=${AI_BUDGET_OPENAI_MAX_REQUESTS_PER_HOUR:300}
ai.budget.openai.max-requests-per-day=${AI_BUDGET_OPENAI_MAX_REQUESTS_PER_DAY:3000}
ai.budget.openai.max-cost-per-day=${AI_BUDGET_OPENAI_MAX_COST_PER_DAY:150.0}
ai.budget.openai.cost-per-image=${AI_BUDGET_OPENAI_COST_PER_IMAGE:0.01}

# File Upload
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=20MB
spring.servlet.multipart.max-request-size=20MB
file.upload.dir=${FILE_UPLOAD_DIR:uploads/avatars}

# CORS Configuration
app.cors.allowed-origins=${APP_CORS_ALLOWED_ORIGINS:http://localhost:3000,http://192.168.137.1:3000,http://192.168.31.25:3000}
app.cors.allowed-origin-patterns=${APP_CORS_ALLOWED_ORIGIN_PATTERNS:}

# Security Configuration
# Disable default Spring Security user (we use JWT authentication)
spring.security.user.name=disabled
spring.security.user.password=disabled

security.login-attempt.max-failed-attempts=${SECURITY_LOGIN_ATTEMPT_MAX_FAILED_ATTEMPTS:5}
security.login-attempt.rate-limit-window-minutes=${SECURITY_LOGIN_ATTEMPT_RATE_LIMIT_WINDOW_MINUTES:15}
security.login-attempt.lockout-duration-minutes=${SECURITY_LOGIN_ATTEMPT_LOCKOUT_DURATION_MINUTES:30}
security.login-attempt.cleanup-days=${SECURITY_LOGIN_ATTEMPT_CLEANUP_DAYS:30}
security.login-attempt.cleanup-cron=${SECURITY_LOGIN_ATTEMPT_CLEANUP_CRON:0 0 2 * * ?}

security.otp.code-length=${SECURITY_OTP_CODE_LENGTH:6}
security.otp.expiration-minutes=${SECURITY_OTP_EXPIRATION_MINUTES:5}
security.otp.max-requests-per-hour=${SECURITY_OTP_MAX_REQUESTS_PER_HOUR:3}

security.session-cleanup.cleanup-cron=${SECURITY_SESSION_CLEANUP_CLEANUP_CRON:0 0 3 * * ?}
security.session-cleanup.retention-days=${SECURITY_SESSION_CLEANUP_RETENTION_DAYS:30}

# Goong Maps API (Vietnam)
goong.api.key=${GOONG_API_KEY:}
goong.api.url.place.autocomplete=https://rsapi.goong.io/Place/AutoComplete
goong.api.url.place.detail=https://rsapi.goong.io/Place/Detail
goong.api.url.geocode=https://rsapi.goong.io/Geocode
goong.api.url.distancematrix=https://rsapi.goong.io/DistanceMatrix

# Resilience4j Retry Configuration
resilience4j.retry.instances.intake-ai.max-attempts=3
resilience4j.retry.instances.intake-ai.wait-duration=2s
resilience4j.retry.instances.intake-ai.enable-exponential-backoff=true
resilience4j.retry.instances.intake-ai.exponential-backoff-multiplier=2
resilience4j.retry.instances.intake-ai.retry-exceptions[0]=org.springframework.web.client.ResourceAccessException
resilience4j.retry.instances.intake-ai.retry-exceptions[1]=org.springframework.web.client.HttpServerErrorException
resilience4j.retry.instances.intake-ai.retry-exceptions[2]=java.net.SocketTimeoutException
# Don't retry on 400 (Client Error) - except maybe 429 if we want to map it, but 429 is usually HttpClientErrorException.TooManyRequests

